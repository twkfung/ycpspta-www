(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1294],{4654:function(){},4116:function(t,e,s){"use strict";var r=s(1096),i=s.n(r),a=s(5721),n=s.n(a),o=s(4829),c=s.n(o),d=s(5524),l=s.n(d);i().extend(n()),i().extend(c()),i().extend(l()),e.Z=i()},7009:function(t,e,s){"use strict";s.d(e,{k:function(){return n}});var r=s(7435),i=s.n(r),a=s(257);let n=i()({nestedKey:"payload",level:a.env.NEXT_LOGGER_LEVEL||"info",browser:{asObject:!0}});n.info("[Pino] Logger version is ".concat(n.version)),n.info("[Pino] Logger level is ".concat(n.level))},949:function(t,e,s){"use strict";s.d(e,{u:function(){return m},k:function(){return S}});var r=s(16),i=s(5933),a=s(99),n=s.n(a),o=s(4116),c=s(5204),d=s(7009),l=s(1229);let g=l.ZP.object({activeTags:l.ZP.string().array()}).passthrough(),h={activeTags:["pta-all-time"]};class u{static create(t){return new u(t)}async loadConfig(){if(this.configLoaded)return;await this.loadTags();let t=this.getTagId(c.x.TAG_SLUGS.PTA_ALL_TIME);if(void 0===t)throw Error("undefined all-time year tag id");this.allTimeYearTagId=t;let e=await this.wp.pages().slug(c.x.PAGE_SLUGS.CONFIG);if(e.length>0){var s;let t=(s=e[0].content.rendered,new DOMParser().parseFromString(s,"text/html").body.textContent||""),r=t?JSON.parse(t):h,i=g.safeParse(r);i.success?this.config=i.data:d.k.error(i.error,"error")}this.activeYearTagIds=(await Promise.all(this.config.activeTags.map(async t=>this.getTagId(t)))).filter(t=>void 0!==t),d.k.debug("config: ".concat(JSON.stringify(this.config))),d.k.debug("allTimeYearTagId: ".concat(this.allTimeYearTagId)),d.k.debug("activeYearTagIds: ".concat(JSON.stringify(this.activeYearTagIds))),this.configLoaded=!0}getActiveYearTagIds(t){let e=this.activeYearTagIds;if(this.loadConfig().then(()=>{e=this.activeYearTagIds}),t){if(!e.includes(this.allTimeYearTagId))return[...e,this.allTimeYearTagId]}else if(!1===t)return e.filter(t=>t!==this.allTimeYearTagId);return[...e]}getAllTimeYearTagId(){let t=this.allTimeYearTagId;return this.loadConfig().then(()=>{t=this.allTimeYearTagId}),t}async loadCategories(){if(this.categoriesLoaded)return;d.k.debug("loading categories");let t=c.x.PAGINATION_SIZE,e=1,s=[];try{do(s=await this.wp.categories().perPage(t).page(e)).forEach(t=>{this.categoryIdMap.set(t.slug,t)}),e++;while(s.length>=t)}catch(t){throw d.k.error(t,"Error loading categories"),t}this.categoriesLoaded=!0,d.k.debug("categories loaded")}async loadTags(){if(this.tagsLoaded)return;d.k.debug("loading tags");let t=c.x.PAGINATION_SIZE,e=1,s=[];try{do(s=await this.wp.tags().perPage(t).page(e)).forEach(t=>{this.tagIdMap.set(t.slug,t)}),e++;while(s.length>=t)}catch(t){throw d.k.error(t,"Error loading tags"),t}this.tagsLoaded=!0,d.k.debug("tags loaded")}getCategoryId(t){this.categoriesLoaded||this.loadCategories().then(()=>{});let e=this.categoryIdMap.get(t);if(!e)try{this.wp.categories().slug(t).then(t=>{this.categoryIdMap.set(t[0].slug,t[0])})}catch(s){let e="Error fetching category: ".concat(t);throw d.k.error(e),Error(e)}if(e=this.categoryIdMap.get(t))return e.id}getTagId(t){this.tagsLoaded||this.loadTags().then(()=>{this.tagIdMap});let e=this.tagIdMap.get(t);if(!e)try{this.wp.tags().slug(t).then(t=>{this.tagIdMap.set(t[0].slug,t[0])})}catch(s){let e="Error fetching tag: ".concat(t);throw d.k.error(e),Error(e)}if(e=this.tagIdMap.get(t))return e.id}getTaxonomyIds(t,e){let s=this.getCategoryId(t),r=this.getTagId(e);if(void 0===s||void 0===r)throw d.k.error({categorySlug:t,catId:s,tagSlug:e,tagId:r},"undefined category or tag"),Error("undefined category or tag");return[s,r]}async getPosts(t){let{categorySlug:e,tagIds:s,maxPosts:r=c.x.VISIBLE_ITEMS_PER_PAGE,sticky:i}=t,a=this.getCategoryId(e);if(void 0===a)throw Error("undefined category slug");if(0===s.length||(i&&(r=-1),0===r))return[];let n=c.x.PAGINATION_SIZE,o=s.map(t=>this.fetchMaxPostsByFn(this.createFetchFn({catId:a,tagId:t,sticky:i}),{maxPosts:r,pageSize:n})),d=await Promise.all(o),l=this.combinePosts(d);return r>0?l.slice(0,r):l}createFetchFn(t){let{catId:e,tagId:s,sticky:r}=t;return t=>{d.k.debug("createFetchFn params: ".concat(JSON.stringify({catId:e,tagId:s,sticky:r})));let i=this.wp.posts();return i=(i=(i=(i=(i=(i=i.perPage(t.pageSize).offset(t.offset)).orderby("date").order("desc")).after(c.x.djsAnniversarySince.toISOString())).status("publish")).categories(e)).tags(s),void 0!==r&&(i=i.sticky(r)),i.get()}}async fetchMaxPostsByFn(t,e){let{maxPosts:s,pageSize:r}=e,i=0,a=await t({offset:i,pageSize:r}),n=this.mapWpPosts(a),o=[...n];for(;(void 0===s||s>o.length)&&n.length>=r;)i+=r,a=await t({offset:i,pageSize:r}),o=[...o,...n=this.mapWpPosts(a)];return o}combinePosts(t){let e=t.flat(),s=new Map;e.forEach(t=>s.set(t.postId,t));let r=Array.from(s.values());return r.sort((t,e)=>t.date.isAfter(e.date)?-1:t.date.isBefore(e.date)?1:0),r}async fetchPost(t){let{postId:e}=t,s=await this.wp.posts().id(e).status("publish").get();return d.k.info(s,"postJson"),p(s)}mapWpPosts(t){return t.map(t=>p(t))}constructor(t){this.categoryIdMap=new Map,this.tagIdMap=new Map,this.categoriesLoaded=!1,this.tagsLoaded=!1,this.activeYearTagIds=[],this.allTimeYearTagId=0,this.configLoaded=!1,this.config=h,this.wp=t}}let f=u.create(new(n())({endpoint:"https://pta.ycps.edu.hk/wp-json"})),p=t=>({postId:t.id,date:(0,o.Z)(t.date),guid:t.guid.rendered,title:t.title.rendered,content:t.content.rendered,excerpt:t.excerpt.rendered,sticky:t.sticky});async function y(t){return await f.fetchPost(t)}async function I(t){if(d.k.info("fetchPosts props: ".concat(JSON.stringify(t))),t.filterSticky){let e=await f.getPosts({...t,sticky:!0});d.k.info("fetchPosts getPosts sticky:".concat(JSON.stringify(e.length)));let s=await f.getPosts({...t,sticky:!1});return d.k.info("fetchPosts getPosts non-sticky:".concat(JSON.stringify(s.length))),{stickyPosts:e,posts:s}}let e=await f.getPosts(t);return d.k.info("fetchPosts getPosts all:".concat(JSON.stringify(e.length))),{stickyPosts:[],posts:e}}(async()=>{await f.getAllTimeYearTagId()})();let x=(0,i.no)("categories",{all:null}),E=(0,i.no)("tags",{all:null}),T=(0,i.no)("posts",{single:t=>({queryKey:[t.postId,t],queryFn:e=>y(t)}),byCategory:t=>({queryKey:[t.categorySlug,t.tagIds,t.filterSticky,t],queryFn:e=>I(t)})}),P=(0,i.kR)(x,E,T);function S(t){var e,s;let i={...t,tagIds:null!==(e=t.tagIds)&&void 0!==e?e:f.getActiveYearTagIds(!0),maxPosts:null!==(s=t.maxPosts)&&void 0!==s?s:c.x.VISIBLE_ITEMS_PER_PAGE};return d.k.debug("p: ".concat(JSON.stringify(i))),(0,r.a)(P.posts.byCategory(i))}function m(t){return(0,r.a)(P.posts.single(t))}},5204:function(t,e,s){"use strict";s.d(e,{x:function(){return n}});var r,i,a,n,o=s(4116);(r=n||(n={})).VISIBLE_ITEMS_PER_PAGE=50,r.PAGINATION_SIZE=100,r.djsAnniversarySince=(0,o.Z)("2022-09-01"),(r.PAGE_SLUGS||(r.PAGE_SLUGS={})).CONFIG="config",(i=r.TAG_SLUGS||(r.TAG_SLUGS={})).PTA_ALL_TIME="pta-all-time",i.PTA_2022_TO_2024="pta-2022-2024",(a=r.CATEGORY_SLUGS||(r.CATEGORY_SLUGS={})).MEMBERS_NEWS="members-news",a.MEMBERS_NOTICES="members-notices",a.MEMBERS_NEWSLETTERS="members-newsletters",a.MEMBERS_WELFARE="members-welfare",a.PTA_WORDS="pta-words",a.PTA_EXCO="pta-exco",a.PTA_DOCS="pta-docs",a.PTA_CONTACT="pta-contact",a.HELPERS_RECRUIT="helpers-recruit",a.HELPERS_HANDBOOK="helpers-handbook",a.HELPERS_CODE="helpers-code",a.EVENTS_CALENDAR="events-calendar",a.EVENTS_ALBUMS="events-albums"},6255:function(t,e,s){"use strict";s.d(e,{CenteredBox:function(){return i}});var r=s(8693);let i=(0,s(6210).ZP)(r.Z)({display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100vh",maxHeight:"400px"})},1069:function(t,e,s){"use strict";s.d(e,{Header:function(){return n}});var r=s(7437),i=s(8693),a=s(6387);function n(){return(0,r.jsx)(i.Z,{sx:{display:"flex",justifyContent:"center"},children:(0,r.jsx)(a.Z,{align:"center",variant:"h4",children:"油蔴地天主教小學(海泓道)家長教師會"})})}},6476:function(t,e,s){"use strict";s.d(e,{Post:function(){return y}});var r=s(7437),i=s(2265),a=s(8516),n=s(8984),o=s(6387),c=s(9832),d=s(2700),l=s(268),g=s(555),h=s(6045),u=s(5669),f=s(6796),p=s(7648);function y(t){let{post:e,collapsible:s=!0,defaultCollapsed:y=!1,showDate:I=!1,showPermaLink:x=!1,showStickiness:E=!1}=t,[T,P]=(0,i.useState)(!!y),S=(0,i.useCallback)(()=>{s&&P(t=>!t)},[s]);return(0,r.jsxs)(a.Z,{component:"article",sx:{padding:1},elevation:4,children:[(0,r.jsxs)(n.Z,{onClick:S,children:[(0,r.jsxs)(n.Z,{direction:"row",bgcolor:"lightgrey",paddingLeft:s?0:1,children:[!!s&&(T?(0,r.jsx)(d.Z,{}):(0,r.jsx)(l.Z,{})),(0,r.jsx)(o.Z,{variant:"h6",children:e.title}),E&&e.sticky&&(0,r.jsx)(g.Z,{fontSize:"small"}),x&&(0,r.jsx)(p.default,{href:{pathname:"/post/",query:{postId:e.postId}},onClick:t=>{t.stopPropagation()},children:(0,r.jsx)(c.Z,{"aria-label":"open post",children:(0,r.jsx)(h.Z,{fontSize:"small"})})})]}),I&&(0,r.jsxs)(o.Z,{variant:"caption",children:[(0,r.jsx)(u.Z,{fontSize:"inherit"})," ",e.date.fromNow()]})]}),!T&&(0,r.jsx)(f.UG,{children:e.content})]})}},6687:function(t,e,s){"use strict";s.d(e,{Posts:function(){return f}});var r=s(7437);s(9978);var i=s(7009),a=s(6387),n=s(4013),o=s(3053),c=s(8984),d=s(7494),l=s(5204),g=s(6255),h=s(949),u=s(6476);function f(t){let{categorySlug:e,tagIds:s,showDate:f=!1,maxPosts:p=l.x.VISIBLE_ITEMS_PER_PAGE,collapseAfter:y=5,stickyFirst:I,showPermaLink:x=!1,showStickiness:E=!1}=t,{isPending:T,isError:P,data:S,error:m,refetch:v}=(0,h.k)({categorySlug:e,tagIds:s,filterSticky:!!I,maxPosts:p}),k=async()=>{v()};if(P)return i.k.error(m,"error fetching posts"),(0,r.jsx)("section",{children:(0,r.jsxs)(g.CenteredBox,{children:[(0,r.jsx)(a.Z,{variant:"h5",gutterBottom:!0,color:"error",children:"Error loading data"}),(0,r.jsx)(n.Z,{variant:"contained",onClick:k,children:"Reload"})]})});if(T)return(0,r.jsx)("section",{children:(0,r.jsx)(g.CenteredBox,{children:(0,r.jsx)(o.Z,{})})});let{stickyPosts:w,posts:_}=S;return 0===w.length&&0===_.length?(0,r.jsx)("section",{children:(0,r.jsx)(g.CenteredBox,{children:(0,r.jsx)(a.Z,{children:"Coming soon. Stay tuned."})})}):(0,r.jsxs)("section",{children:[(0,r.jsx)(c.Z,{divider:(0,r.jsx)(d.Z,{flexItem:!0}),children:w.map((t,e)=>(0,r.jsx)(u.Post,{showDate:f,post:t,defaultCollapsed:!1,showPermaLink:x,showStickiness:E},t.guid))}),(0,r.jsx)(c.Z,{divider:(0,r.jsx)(d.Z,{flexItem:!0}),children:_.map((t,e)=>(0,r.jsx)(u.Post,{showDate:f,post:t,defaultCollapsed:void 0!==y&&!(y<0)&&e>=y,showPermaLink:x,showStickiness:E},t.guid))})]})}},6796:function(t,e,s){"use strict";s.d(e,{UG:function(){return o},m$:function(){return l}}),s(6255);var r=s(7437);s(1069);var i=s(9976),a=s(1305),n=s(51);let o=t=>{let{children:e}=t;return(0,r.jsx)(i.U,{remarkPlugins:[a.Z],rehypePlugins:[n.Z],children:e})};s(6476),s(6687);var c=s(8693),d=s(6387);let l=t=>e=>{let{children:s}=e;return(0,r.jsxs)(c.Z,{children:[(0,r.jsx)("header",{children:(0,r.jsx)(d.Z,{variant:"h5",color:"secondary.contrastText",bgcolor:"secondary.main",paddingX:1,align:"center",children:t.title})}),(0,r.jsx)("section",{children:(0,r.jsx)(c.Z,{sx:{paddingX:0},children:s})})]})}},9978:function(){}}]);