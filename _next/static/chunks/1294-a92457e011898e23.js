(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1294],{24654:function(){},4116:function(t,e,s){"use strict";var r=s(71096),i=s.n(r),a=s(45721),n=s.n(a),o=s(14829),c=s.n(o),l=s(5524),d=s.n(l);i().extend(n()),i().extend(c()),i().extend(d()),e.Z=i()},57009:function(t,e,s){"use strict";s.d(e,{k:function(){return n}});var r=s(97435),i=s.n(r),a=s(40257);let n=i()({nestedKey:"payload",level:a.env.NEXT_LOGGER_LEVEL||"info",browser:{asObject:!0}});n.info("[Pino] Logger version is ".concat(n.version)),n.info("[Pino] Logger level is ".concat(n.level))},30949:function(t,e,s){"use strict";s.d(e,{u:function(){return m},k:function(){return S}});var r=s(20016),i=s(85933),a=s(50099),n=s.n(a),o=s(4116),c=s(65204),l=s(57009),d=s(31229);let g=d.ZP.object({activeTags:d.ZP.string().array()}).passthrough(),h={activeTags:["pta-all-time"]};class u{static create(t){return new u(t)}async loadConfig(){if(this.configLoaded)return;await this.loadTags();let t=this.getTagId(c.x.TAG_SLUGS.PTA_ALL_TIME);if(void 0===t)throw Error("undefined all-time year tag id");this.allTimeYearTagId=t;let e=await this.wp.pages().slug(c.x.PAGE_SLUGS.CONFIG);if(e.length>0){var s;let t=(s=e[0].content.rendered,new DOMParser().parseFromString(s,"text/html").body.textContent||""),r=t?JSON.parse(t):h,i=g.safeParse(r);i.success?this.config=i.data:l.k.error(i.error,"error")}this.activeYearTagIds=(await Promise.all(this.config.activeTags.map(async t=>this.getTagId(t)))).filter(t=>void 0!==t),l.k.debug("config: ".concat(JSON.stringify(this.config))),l.k.debug("allTimeYearTagId: ".concat(this.allTimeYearTagId)),l.k.debug("activeYearTagIds: ".concat(JSON.stringify(this.activeYearTagIds))),this.configLoaded=!0}getActiveYearTagIds(t){let e=this.activeYearTagIds;if(this.loadConfig().then(()=>{e=this.activeYearTagIds}),t){if(!e.includes(this.allTimeYearTagId))return[...e,this.allTimeYearTagId]}else if(!1===t)return e.filter(t=>t!==this.allTimeYearTagId);return[...e]}getAllTimeYearTagId(){let t=this.allTimeYearTagId;return this.loadConfig().then(()=>{t=this.allTimeYearTagId}),t}async loadCategories(){if(this.categoriesLoaded)return;l.k.debug("loading categories");let t=c.x.PAGINATION_SIZE,e=1,s=[];try{do(s=await this.wp.categories().perPage(t).page(e)).forEach(t=>{this.categoryIdMap.set(t.slug,t)}),e++;while(s.length>=t)}catch(t){throw l.k.error(t,"Error loading categories"),t}this.categoriesLoaded=!0,l.k.debug("categories loaded")}async loadTags(){if(this.tagsLoaded)return;l.k.debug("loading tags");let t=c.x.PAGINATION_SIZE,e=1,s=[];try{do(s=await this.wp.tags().perPage(t).page(e)).forEach(t=>{this.tagIdMap.set(t.slug,t)}),e++;while(s.length>=t)}catch(t){throw l.k.error(t,"Error loading tags"),t}this.tagsLoaded=!0,l.k.debug("tags loaded")}getCategoryId(t){this.categoriesLoaded||this.loadCategories().then(()=>{});let e=this.categoryIdMap.get(t);if(!e)try{this.wp.categories().slug(t).then(t=>{this.categoryIdMap.set(t[0].slug,t[0])})}catch(s){let e="Error fetching category: ".concat(t);throw l.k.error(e),Error(e)}if(e=this.categoryIdMap.get(t))return e.id}getTagId(t){this.tagsLoaded||this.loadTags().then(()=>{this.tagIdMap});let e=this.tagIdMap.get(t);if(!e)try{this.wp.tags().slug(t).then(t=>{this.tagIdMap.set(t[0].slug,t[0])})}catch(s){let e="Error fetching tag: ".concat(t);throw l.k.error(e),Error(e)}if(e=this.tagIdMap.get(t))return e.id}getTaxonomyIds(t,e){let s=this.getCategoryId(t),r=this.getTagId(e);if(void 0===s||void 0===r)throw l.k.error({categorySlug:t,catId:s,tagSlug:e,tagId:r},"undefined category or tag"),Error("undefined category or tag");return[s,r]}async getPosts(t){let{categorySlug:e,tagIds:s,maxPosts:r=c.x.VISIBLE_ITEMS_PER_PAGE,sticky:i}=t,a=this.getCategoryId(e);if(void 0===a)throw Error("undefined category slug");if(0===s.length||(i&&(r=-1),0===r))return[];let n=c.x.PAGINATION_SIZE,o=s.map(t=>this.fetchMaxPostsByFn(this.createFetchFn({catId:a,tagId:t,sticky:i}),{maxPosts:r,pageSize:n})),l=await Promise.all(o),d=this.combinePosts(l);return r>0?d.slice(0,r):d}createFetchFn(t){let{catId:e,tagId:s,sticky:r}=t;return t=>{l.k.debug("createFetchFn params: ".concat(JSON.stringify({catId:e,tagId:s,sticky:r})));let i=this.wp.posts();return i=(i=(i=(i=(i=(i=i.perPage(t.pageSize).offset(t.offset)).orderby("date").order("desc")).after(c.x.djsAnniversarySince.toISOString())).status("publish")).categories(e)).tags(s),void 0!==r&&(i=i.sticky(r)),i.get()}}async fetchMaxPostsByFn(t,e){let{maxPosts:s,pageSize:r}=e,i=0,a=await t({offset:i,pageSize:r}),n=this.mapWpPosts(a),o=[...n];for(;(void 0===s||s>o.length)&&n.length>=r;)i+=r,a=await t({offset:i,pageSize:r}),o=[...o,...n=this.mapWpPosts(a)];return o}combinePosts(t){let e=t.flat(),s=new Map;e.forEach(t=>s.set(t.postId,t));let r=Array.from(s.values());return r.sort((t,e)=>t.date.isAfter(e.date)?-1:t.date.isBefore(e.date)?1:0),r}async fetchPostById(t){let{postId:e}=t,s=await this.wp.posts().id(e).status("publish").get();return l.k.info({postJson:s},"postJson"),p(s)}async fetchPostBySlug(t){let{slug:e}=t,s=await this.wp.posts().slug(e).status("publish").get();l.k.info({postsJson:s},"postJson");let r=this.mapWpPosts(s);if(r.length>0)return r[0];throw Error('Post not found by slug: "'.concat(e,'"'))}mapWpPosts(t){return t.map(t=>p(t))}constructor(t){this.categoryIdMap=new Map,this.tagIdMap=new Map,this.categoriesLoaded=!1,this.tagsLoaded=!1,this.activeYearTagIds=[],this.allTimeYearTagId=0,this.configLoaded=!1,this.config=h,this.wp=t}}let f=u.create(new(n())({endpoint:"https://pta.ycps.edu.hk/wp-json"})),p=t=>({postId:t.id,date:(0,o.Z)(t.date),guid:t.guid.rendered,slug:t.slug,title:t.title.rendered,content:t.content.rendered,excerpt:t.excerpt.rendered,sticky:t.sticky});async function y(t){return t.postId?await f.fetchPostById({postId:t.postId}):await f.fetchPostBySlug(t)}async function I(t){if(l.k.info("fetchPosts props: ".concat(JSON.stringify(t))),t.filterSticky){let e=await f.getPosts({...t,sticky:!0});l.k.info("fetchPosts getPosts sticky:".concat(JSON.stringify(e.length)));let s=await f.getPosts({...t,sticky:!1});return l.k.info("fetchPosts getPosts non-sticky:".concat(JSON.stringify(s.length))),{stickyPosts:e,posts:s}}let e=await f.getPosts(t);return l.k.info("fetchPosts getPosts all:".concat(JSON.stringify(e.length))),{stickyPosts:[],posts:e}}(async()=>{await f.getAllTimeYearTagId()})();let x=(0,i.no)("categories",{all:null}),E=(0,i.no)("tags",{all:null}),P=(0,i.no)("posts",{single:t=>({queryKey:[t.postId?t.postId:t.slug,t],queryFn:e=>y(t)}),byCategory:t=>({queryKey:[t.categorySlug,t.tagIds,t.filterSticky,t],queryFn:e=>I(t)})}),T=(0,i.kR)(x,E,P);function S(t){var e,s;let i={...t,tagIds:null!==(e=t.tagIds)&&void 0!==e?e:f.getActiveYearTagIds(!0),maxPosts:null!==(s=t.maxPosts)&&void 0!==s?s:c.x.VISIBLE_ITEMS_PER_PAGE};return l.k.debug("p: ".concat(JSON.stringify(i))),(0,r.a)(T.posts.byCategory(i))}function m(t){return(0,r.a)(T.posts.single(t))}},65204:function(t,e,s){"use strict";s.d(e,{x:function(){return n}});var r,i,a,n,o=s(4116);(r=n||(n={})).VISIBLE_ITEMS_PER_PAGE=50,r.PAGINATION_SIZE=100,r.djsAnniversarySince=(0,o.Z)("2022-09-01"),(r.PAGE_SLUGS||(r.PAGE_SLUGS={})).CONFIG="config",(i=r.TAG_SLUGS||(r.TAG_SLUGS={})).PTA_ALL_TIME="pta-all-time",i.PTA_2022_TO_2024="pta-2022-2024",(a=r.CATEGORY_SLUGS||(r.CATEGORY_SLUGS={})).MEMBERS_NEWS="members-news",a.MEMBERS_NOTICES="members-notices",a.MEMBERS_NEWSLETTERS="members-newsletters",a.MEMBERS_WELFARE="members-welfare",a.PTA_WORDS="pta-words",a.PTA_EXCO="pta-exco",a.PTA_DOCS="pta-docs",a.PTA_CONTACT="pta-contact",a.HELPERS_RECRUIT="helpers-recruit",a.HELPERS_HANDBOOK="helpers-handbook",a.HELPERS_CODE="helpers-code",a.EVENTS_CALENDAR="events-calendar",a.EVENTS_ALBUMS="events-albums"},46255:function(t,e,s){"use strict";s.d(e,{CenteredBox:function(){return i}});var r=s(78693);let i=(0,s(16210).ZP)(r.Z)({display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100vh",maxHeight:"400px"})},41069:function(t,e,s){"use strict";s.d(e,{Header:function(){return n}});var r=s(57437),i=s(78693),a=s(46387);function n(){return(0,r.jsx)(i.Z,{sx:{display:"flex",justifyContent:"center"},children:(0,r.jsx)(a.Z,{align:"center",variant:"h4",children:"油蔴地天主教小學(海泓道)家長教師會"})})}},56476:function(t,e,s){"use strict";s.d(e,{Post:function(){return I}});var r=s(57437),i=s(2265),a=s(8516),n=s(8984),o=s(46387),c=s(14435),l=s(59832),d=s(52700),g=s(60268),h=s(555),u=s(86045),f=s(75669),p=s(96796),y=s(27648);function I(t){let{post:e,collapsible:s=!0,defaultCollapsed:I=!1,showDate:x=!1,showPermaLink:E=!1,showStickiness:P=!1,showSlugLink:T=!1}=t,[S,m]=(0,i.useState)(!!I),k=(0,i.useCallback)(()=>{s&&m(t=>!t)},[s]);return(0,r.jsxs)(a.Z,{component:"article",sx:{padding:1},elevation:4,children:[(0,r.jsxs)(n.Z,{onClick:k,children:[(0,r.jsxs)(n.Z,{direction:"row",bgcolor:"lightgrey",paddingLeft:s?0:1,children:[!!s&&(S?(0,r.jsx)(d.Z,{}):(0,r.jsx)(g.Z,{})),(0,r.jsx)(o.Z,{variant:"h6",children:e.title}),P&&e.sticky&&(0,r.jsx)(h.Z,{fontSize:"small"}),E&&(0,r.jsx)(c.Z,{title:"open permalink",children:(0,r.jsx)(y.default,{href:{pathname:"/post/",query:{postId:e.postId}},onClick:t=>{t.stopPropagation()},children:(0,r.jsx)(l.Z,{"aria-label":"open post",children:(0,r.jsx)(u.Z,{fontSize:"small"})})})}),T&&(0,r.jsx)(c.Z,{title:"open slug link",children:(0,r.jsx)(y.default,{href:{pathname:"/post/",query:{slug:e.slug}},onClick:t=>{t.stopPropagation()},children:(0,r.jsx)(l.Z,{"aria-label":"open post",children:(0,r.jsx)(u.Z,{fontSize:"small"})})})})]}),x&&(0,r.jsxs)(o.Z,{variant:"caption",children:[(0,r.jsx)(f.Z,{fontSize:"inherit"})," ",e.date.fromNow()]})]}),!S&&(0,r.jsx)(p.UG,{children:e.content})]})}},46687:function(t,e,s){"use strict";s.d(e,{Posts:function(){return f}});var r=s(57437);s(99978);var i=s(57009),a=s(46387),n=s(94013),o=s(73053),c=s(8984),l=s(97494),d=s(65204),g=s(46255),h=s(30949),u=s(56476);function f(t){let{categorySlug:e,tagIds:s,showDate:f=!1,maxPosts:p=d.x.VISIBLE_ITEMS_PER_PAGE,collapseAfter:y=5,stickyFirst:I,showPermaLink:x=!1,showStickiness:E=!1}=t,{isPending:P,isError:T,data:S,error:m,refetch:k}=(0,h.k)({categorySlug:e,tagIds:s,filterSticky:!!I,maxPosts:p}),w=async()=>{k()};if(T)return i.k.error(m,"error fetching posts"),(0,r.jsx)("section",{children:(0,r.jsxs)(g.CenteredBox,{children:[(0,r.jsx)(a.Z,{variant:"h5",gutterBottom:!0,color:"error",children:"Error loading data"}),(0,r.jsx)(n.Z,{variant:"contained",onClick:w,children:"Reload"})]})});if(P)return(0,r.jsx)("section",{children:(0,r.jsx)(g.CenteredBox,{children:(0,r.jsx)(o.Z,{})})});let{stickyPosts:v,posts:j}=S;return 0===v.length&&0===j.length?(0,r.jsx)("section",{children:(0,r.jsx)(g.CenteredBox,{children:(0,r.jsx)(a.Z,{children:"Coming soon. Stay tuned."})})}):(0,r.jsxs)("section",{children:[(0,r.jsx)(c.Z,{divider:(0,r.jsx)(l.Z,{flexItem:!0}),children:v.map((t,e)=>(0,r.jsx)(u.Post,{showDate:f,post:t,defaultCollapsed:!1,showPermaLink:x,showStickiness:E},t.guid))}),(0,r.jsx)(c.Z,{divider:(0,r.jsx)(l.Z,{flexItem:!0}),children:j.map((t,e)=>(0,r.jsx)(u.Post,{showDate:f,post:t,defaultCollapsed:void 0!==y&&!(y<0)&&e>=y,showPermaLink:x,showStickiness:E},t.guid))})]})}},96796:function(t,e,s){"use strict";s.d(e,{UG:function(){return o},m$:function(){return d}}),s(46255);var r=s(57437);s(41069);var i=s(19976),a=s(91305),n=s(50051);let o=t=>{let{children:e}=t;return(0,r.jsx)(i.U,{remarkPlugins:[a.Z],rehypePlugins:[n.Z],children:e})};s(56476),s(46687);var c=s(78693),l=s(46387);let d=t=>e=>{let{children:s}=e;return(0,r.jsxs)(c.Z,{children:[(0,r.jsx)("header",{children:(0,r.jsx)(l.Z,{variant:"h5",color:"secondary.contrastText",bgcolor:"secondary.main",paddingX:1,align:"center",children:t.title})}),(0,r.jsx)("section",{children:(0,r.jsx)(c.Z,{sx:{paddingX:0},children:s})})]})}},99978:function(){}}]);