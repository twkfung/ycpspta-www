(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8e3],{42634:()=>{},47612:(t,e,s)=>{"use strict";s.d(e,{A:()=>g});var r=s(21455),a=s.n(r),i=s(3426),n=s.n(i),o=s(60375),l=s.n(o),d=s(56533),c=s.n(d);a().extend(n()),a().extend(l()),a().extend(c());let g=a()},72109:(t,e,s)=>{"use strict";s.d(e,{v:()=>n});var r=s(28509),a=s.n(r),i=s(2818);let n=a()({nestedKey:"payload",level:i.env.NEXT_LOGGER_LEVEL||"info",browser:{asObject:!0}});n.info("[Pino] Logger version is ".concat(n.version)),n.info("[Pino] Logger level is ".concat(n.level))},53441:(t,e,s)=>{"use strict";s.d(e,{Y:()=>P,j:()=>T});var r=s(88629),a=s(14827),i=s(59873),n=s.n(i),o=s(47612),l=s(24570),d=s(72109),c=s(43415);let g=c.Ay.object({activeTags:c.Ay.string().array()}).passthrough(),h={activeTags:["pta-all-time"]};class u{static create(t){return new u(t)}async loadConfig(){if(this.configLoaded)return;await this.loadTags();let t=this.getTagId(l.$.TAG_SLUGS.PTA_ALL_TIME);if(void 0===t)throw Error("undefined all-time year tag id");this.allTimeYearTagId=t;let e=await this.wp.pages().slug(l.$.PAGE_SLUGS.CONFIG);if(e.length>0){var s;let t=(s=e[0].content.rendered,new DOMParser().parseFromString(s,"text/html").body.textContent||""),r=t?JSON.parse(t):h,a=g.safeParse(r);a.success?this.config=a.data:d.v.error(a.error,"error")}this.activeYearTagIds=(await Promise.all(this.config.activeTags.map(async t=>this.getTagId(t)))).filter(t=>void 0!==t),d.v.debug("config: ".concat(JSON.stringify(this.config))),d.v.debug("allTimeYearTagId: ".concat(this.allTimeYearTagId)),d.v.debug("activeYearTagIds: ".concat(JSON.stringify(this.activeYearTagIds))),this.configLoaded=!0}getActiveYearTagIds(t){let e=this.activeYearTagIds;if(this.loadConfig().then(()=>{e=this.activeYearTagIds}),t){if(!e.includes(this.allTimeYearTagId))return[...e,this.allTimeYearTagId]}else if(!1===t)return e.filter(t=>t!==this.allTimeYearTagId);return[...e]}getAllTimeYearTagId(){let t=this.allTimeYearTagId;return this.loadConfig().then(()=>{t=this.allTimeYearTagId}),t}async loadCategories(){if(this.categoriesLoaded)return;d.v.debug("loading categories");let t=l.$.PAGINATION_SIZE,e=1,s=[];try{do(s=await this.wp.categories().perPage(t).page(e)).forEach(t=>{this.categoryIdMap.set(t.slug,t)}),e++;while(s.length>=t)}catch(t){throw d.v.error(t,"Error loading categories"),t}this.categoriesLoaded=!0,d.v.debug("categories loaded")}async loadTags(){if(this.tagsLoaded)return;d.v.debug("loading tags");let t=l.$.PAGINATION_SIZE,e=1,s=[];try{do(s=await this.wp.tags().perPage(t).page(e)).forEach(t=>{this.tagIdMap.set(t.slug,t)}),e++;while(s.length>=t)}catch(t){throw d.v.error(t,"Error loading tags"),t}this.tagsLoaded=!0,d.v.debug("tags loaded")}getCategoryId(t){this.categoriesLoaded||this.loadCategories().then(()=>{});let e=this.categoryIdMap.get(t);if(!e)try{this.wp.categories().slug(t).then(t=>{this.categoryIdMap.set(t[0].slug,t[0])})}catch(s){let e="Error fetching category: ".concat(t);throw d.v.error(e),Error(e)}if(e=this.categoryIdMap.get(t))return e.id}getTagId(t){this.tagsLoaded||this.loadTags().then(()=>{this.tagIdMap});let e=this.tagIdMap.get(t);if(!e)try{this.wp.tags().slug(t).then(t=>{this.tagIdMap.set(t[0].slug,t[0])})}catch(s){let e="Error fetching tag: ".concat(t);throw d.v.error(e),Error(e)}if(e=this.tagIdMap.get(t))return e.id}getTaxonomyIds(t,e){let s=this.getCategoryId(t),r=this.getTagId(e);if(void 0===s||void 0===r)throw d.v.error({categorySlug:t,catId:s,tagSlug:e,tagId:r},"undefined category or tag"),Error("undefined category or tag");return[s,r]}async getPosts(t){let{categorySlug:e,tagIds:s,maxPosts:r=l.$.VISIBLE_ITEMS_PER_PAGE,sticky:a}=t,i=this.getCategoryId(e);if(void 0===i)throw Error("undefined category slug");if(0===s.length||(a&&(r=-1),0===r))return[];let n=l.$.PAGINATION_SIZE,o=s.map(t=>this.fetchMaxPostsByFn(this.createFetchFn({catId:i,tagId:t,sticky:a}),{maxPosts:r,pageSize:n})),d=await Promise.all(o),c=this.combinePosts(d);return r>0?c.slice(0,r):c}createFetchFn(t){let{catId:e,tagId:s,sticky:r}=t;return t=>{d.v.debug("createFetchFn params: ".concat(JSON.stringify({catId:e,tagId:s,sticky:r})));let a=this.wp.posts();return a=(a=(a=(a=(a=(a=a.perPage(t.pageSize).offset(t.offset)).orderby("date").order("desc")).after(l.$.djsAnniversarySince.toISOString())).status("publish")).categories(e)).tags(s),void 0!==r&&(a=a.sticky(r)),a.get()}}async fetchMaxPostsByFn(t,e){let{maxPosts:s,pageSize:r}=e,a=0,i=await t({offset:a,pageSize:r}),n=this.mapWpPosts(i),o=[...n];for(;(void 0===s||s>o.length)&&n.length>=r;)a+=r,i=await t({offset:a,pageSize:r}),o=[...o,...n=this.mapWpPosts(i)];return o}combinePosts(t){let e=t.flat(),s=new Map;e.forEach(t=>s.set(t.postId,t));let r=Array.from(s.values());return r.sort((t,e)=>t.date.isAfter(e.date)?-1:t.date.isBefore(e.date)?1:0),r}async fetchPostById(t){let{postId:e}=t,s=await this.wp.posts().id(e).status("publish").get();return d.v.info({postJson:s},"postJson"),f(s)}async fetchPostBySlug(t){let{slug:e}=t,s=await this.wp.posts().slug(e).status("publish").get();d.v.info({postsJson:s},"postJson");let r=this.mapWpPosts(s);if(r.length>0)return r[0];throw Error('Post not found by slug: "'.concat(e,'"'))}mapWpPosts(t){return t.map(t=>f(t))}constructor(t){this.categoryIdMap=new Map,this.tagIdMap=new Map,this.categoriesLoaded=!1,this.tagsLoaded=!1,this.activeYearTagIds=[],this.allTimeYearTagId=0,this.configLoaded=!1,this.config=h,this.wp=t}}let p=u.create(new(n())({endpoint:"https://pta.ycps.edu.hk/wp-json"})),f=t=>({postId:t.id,date:(0,o.A)(t.date),guid:t.guid.rendered,slug:t.slug,title:t.title.rendered,content:t.content.rendered,excerpt:t.excerpt.rendered,sticky:t.sticky});async function y(t){return t.postId?await p.fetchPostById({postId:t.postId}):await p.fetchPostBySlug(t)}async function I(t){if(d.v.info("fetchPosts props: ".concat(JSON.stringify(t))),t.filterSticky){let e=await p.getPosts({...t,sticky:!0});d.v.info("fetchPosts getPosts sticky:".concat(JSON.stringify(e.length)));let s=await p.getPosts({...t,sticky:!1});return d.v.info("fetchPosts getPosts non-sticky:".concat(JSON.stringify(s.length))),{stickyPosts:e,posts:s}}let e=await p.getPosts(t);return d.v.info("fetchPosts getPosts all:".concat(JSON.stringify(e.length))),{stickyPosts:[],posts:e}}(async()=>{await p.getAllTimeYearTagId()})();let v=(0,a.DY)("categories",{all:null}),A=(0,a.DY)("tags",{all:null}),E=(0,a.DY)("posts",{single:t=>({queryKey:[function(t){return t.postId?t.postId:t.slug}(t),t],queryFn:e=>y(t)}),byCategory:t=>({queryKey:[t.categorySlug,t.tagIds,t.filterSticky,t],queryFn:e=>I(t)})}),S=(0,a.h0)(v,A,E);function T(t){var e,s;let a={...t,tagIds:null!==(e=t.tagIds)&&void 0!==e?e:p.getActiveYearTagIds(!0),maxPosts:null!==(s=t.maxPosts)&&void 0!==s?s:l.$.VISIBLE_ITEMS_PER_PAGE};return d.v.debug("p: ".concat(JSON.stringify(a))),(0,r.I)(S.posts.byCategory(a))}function P(t){return(0,r.I)(S.posts.single(t))}},24570:(t,e,s)=>{"use strict";s.d(e,{$:()=>r});var r,a=s(47612);!function(t){var e;t.VISIBLE_ITEMS_PER_PAGE=50,t.PAGINATION_SIZE=100,t.djsAnniversarySince=(0,a.A)("2022-09-01"),(t.PAGE_SLUGS||(t.PAGE_SLUGS={})).CONFIG="config",(t.TAG_SLUGS||(t.TAG_SLUGS={})).PTA_ALL_TIME="pta-all-time",(e=t.CATEGORY_SLUGS||(t.CATEGORY_SLUGS={})).MEMBERS_NEWS="members-news",e.MEMBERS_NOTICES="members-notices",e.MEMBERS_NEWSLETTERS="members-newsletters",e.MEMBERS_WELFARE="members-welfare",e.PTA_WORDS="pta-words",e.PTA_EXCO="pta-exco",e.PTA_DOCS="pta-docs",e.PTA_CONTACT="pta-contact",e.HELPERS_RECRUIT="helpers-recruit",e.HELPERS_HANDBOOK="helpers-handbook",e.HELPERS_CODE="helpers-code",e.EVENTS_CALENDAR="events-calendar",e.EVENTS_ALBUMS="events-albums",e.EVENTS_PROMO="events-promo"}(r||(r={}))},13088:(t,e,s)=>{"use strict";s.d(e,{CenteredBox:()=>a});var r=s(82784);let a=(0,s(89142).Ay)(r.A)({display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100vh",maxHeight:"400px"})},18618:(t,e,s)=>{"use strict";s.d(e,{Header:()=>n});var r=s(95155),a=s(82784),i=s(9561);function n(){return(0,r.jsx)(a.A,{sx:{display:"flex",justifyContent:"center"},children:(0,r.jsx)(i.A,{align:"center",variant:"h4",children:"油蔴地天主教小學(海泓道)家長教師會"})})}},68203:(t,e,s)=>{"use strict";s.d(e,{Post:()=>v});var r=s(95155),a=s(12115),i=s(85819),n=s(70226),o=s(9561),l=s(32631),d=s(894),c=s(51644),g=s(15524),h=s(52238),u=s(82450),p=s(28696),f=s(17916),y=s(48173),I=s.n(y);function v(t){let{post:e,collapsible:s=!0,defaultCollapsed:y=!1,showDate:v=!1,showPermaLink:A=!1,showStickiness:E=!1,showSlugLink:S=!1}=t,[T,P]=(0,a.useState)(!!y),x=(0,a.useCallback)(()=>{s&&P(t=>!t)},[s]);return(0,r.jsxs)(i.A,{component:"article",sx:{padding:1},elevation:4,children:[(0,r.jsxs)(n.A,{onClick:x,children:[(0,r.jsxs)(n.A,{direction:"row",bgcolor:"lightgrey",paddingLeft:s?0:1,children:[!!s&&(T?(0,r.jsx)(c.A,{}):(0,r.jsx)(g.A,{})),(0,r.jsx)(o.A,{variant:"h6",children:e.title}),E&&e.sticky&&(0,r.jsx)(h.A,{fontSize:"small"}),A&&(0,r.jsx)(l.A,{title:"open permalink",children:(0,r.jsx)(I(),{href:{pathname:"/post/",query:{postId:e.postId}},onClick:t=>{t.stopPropagation()},children:(0,r.jsx)(d.A,{"aria-label":"open post",children:(0,r.jsx)(u.A,{fontSize:"small"})})})}),S&&(0,r.jsx)(l.A,{title:"open slug link",children:(0,r.jsx)(I(),{href:{pathname:"/post/",query:{slug:e.slug}},onClick:t=>{t.stopPropagation()},children:(0,r.jsx)(d.A,{"aria-label":"open post",children:(0,r.jsx)(u.A,{fontSize:"small"})})})})]}),v&&(0,r.jsxs)(o.A,{variant:"caption",children:[(0,r.jsx)(p.A,{fontSize:"inherit"})," ",e.date.fromNow()]})]}),!T&&(0,r.jsx)(f.oz,{children:e.content})]})}},34350:(t,e,s)=>{"use strict";s.d(e,{Posts:()=>p});var r=s(95155);s(55065);var a=s(72109),i=s(9561),n=s(22282),o=s(77311),l=s(70226),d=s(31775),c=s(24570),g=s(13088),h=s(53441),u=s(68203);function p(t){let{categorySlug:e,tagIds:s,showDate:p=!1,maxPosts:f=c.$.VISIBLE_ITEMS_PER_PAGE,collapseAfter:y=5,stickyFirst:I,showPermaLink:v=!1,showStickiness:A=!1}=t,{isPending:E,isError:S,data:T,error:P,refetch:x}=(0,h.j)({categorySlug:e,tagIds:s,filterSticky:!!I,maxPosts:f}),m=async()=>{x()};if(S)return a.v.error(P,"error fetching posts"),(0,r.jsx)("section",{children:(0,r.jsxs)(g.CenteredBox,{children:[(0,r.jsx)(i.A,{variant:"h5",gutterBottom:!0,color:"error",children:"Error loading data"}),(0,r.jsx)(n.A,{variant:"contained",onClick:m,children:"Reload"})]})});if(E)return(0,r.jsx)("section",{children:(0,r.jsx)(g.CenteredBox,{children:(0,r.jsx)(o.A,{})})});let{stickyPosts:w,posts:j}=T;return 0===w.length&&0===j.length?(0,r.jsx)("section",{children:(0,r.jsx)(g.CenteredBox,{children:(0,r.jsx)(i.A,{children:"Coming soon. Stay tuned."})})}):(0,r.jsxs)("section",{children:[(0,r.jsx)(l.A,{divider:(0,r.jsx)(d.A,{flexItem:!0}),children:w.map((t,e)=>(0,r.jsx)(u.Post,{showDate:p,post:t,defaultCollapsed:!1,showPermaLink:v,showStickiness:A},t.guid))}),(0,r.jsx)(l.A,{divider:(0,r.jsx)(d.A,{flexItem:!0}),children:j.map((t,e)=>(0,r.jsx)(u.Post,{showDate:p,post:t,defaultCollapsed:void 0!==y&&!(y<0)&&e>=y,showPermaLink:v,showStickiness:A},t.guid))})]})}},17916:(t,e,s)=>{"use strict";s.d(e,{oz:()=>o,l6:()=>c}),s(13088);var r=s(95155);s(18618);var a=s(30426),i=s(48107),n=s(91938);let o=t=>{let{children:e}=t;return(0,r.jsx)(a.o,{remarkPlugins:[i.A],rehypePlugins:[n.A],children:e})};s(68203),s(34350);var l=s(82784),d=s(9561);let c=t=>e=>{let{children:s}=e;return(0,r.jsxs)(l.A,{children:[(0,r.jsx)("header",{children:(0,r.jsx)(d.A,{variant:"h5",color:"secondary.contrastText",bgcolor:"secondary.main",paddingX:1,align:"center",children:t.title})}),(0,r.jsx)("section",{children:(0,r.jsx)(l.A,{sx:{paddingX:0},children:s})})]})}},55065:()=>{}}]);