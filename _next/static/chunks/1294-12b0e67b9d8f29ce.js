(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1294],{4654:function(){},4116:function(t,e,s){"use strict";var r=s(1096),a=s.n(r),i=s(5721),n=s.n(i),o=s(4829),c=s.n(o),d=s(5524),l=s.n(d);a().extend(n()),a().extend(c()),a().extend(l()),e.Z=a()},7009:function(t,e,s){"use strict";s.d(e,{k:function(){return n}});var r=s(7435),a=s.n(r),i=s(257);let n=a()({nestedKey:"payload",level:i.env.NEXT_LOGGER_LEVEL||"info",browser:{asObject:!0}});n.info("[Pino] Logger version is ".concat(n.version)),n.info("[Pino] Logger level is ".concat(n.level))},949:function(t,e,s){"use strict";s.d(e,{u:function(){return m},k:function(){return S}});var r=s(16),a=s(5933),i=s(99),n=s.n(i),o=s(4116),c=s(5204),d=s(7009),l=s(1229);let g=l.ZP.object({activeTags:l.ZP.string().array()}).passthrough(),h={activeTags:["pta-all-time"]};class u{static create(t){return new u(t)}async loadConfig(){if(this.configLoaded)return;await this.loadTags();let t=this.getTagId(c.x.TAG_SLUGS.PTA_ALL_TIME);if(void 0===t)throw Error("undefined all-time year tag id");this.allTimeYearTagId=t;let e=await this.wp.pages().slug(c.x.PAGE_SLUGS.CONFIG);if(e.length>0){var s;let t=(s=e[0].content.rendered,new DOMParser().parseFromString(s,"text/html").body.textContent||""),r=t?JSON.parse(t):h,a=g.safeParse(r);a.success?this.config=a.data:d.k.error(a.error,"error")}this.activeYearTagIds=(await Promise.all(this.config.activeTags.map(async t=>this.getTagId(t)))).filter(t=>void 0!==t),d.k.debug("config: ".concat(JSON.stringify(this.config))),d.k.debug("allTimeYearTagId: ".concat(this.allTimeYearTagId)),d.k.debug("activeYearTagIds: ".concat(JSON.stringify(this.activeYearTagIds))),this.configLoaded=!0}getActiveYearTagIds(t){let e=this.activeYearTagIds;if(this.loadConfig().then(()=>{e=this.activeYearTagIds}),t){if(!e.includes(this.allTimeYearTagId))return[...e,this.allTimeYearTagId]}else if(!1===t)return e.filter(t=>t!==this.allTimeYearTagId);return[...e]}getAllTimeYearTagId(){let t=this.allTimeYearTagId;return this.loadConfig().then(()=>{t=this.allTimeYearTagId}),t}async loadCategories(){if(this.categoriesLoaded)return;d.k.debug("loading categories");let t=c.x.PAGINATION_SIZE,e=1,s=[];try{do(s=await this.wp.categories().perPage(t).page(e)).forEach(t=>{this.categoryIdMap.set(t.slug,t)}),e++;while(s.length>=t)}catch(t){throw d.k.error(t,"Error loading categories"),t}this.categoriesLoaded=!0,d.k.debug("categories loaded")}async loadTags(){if(this.tagsLoaded)return;d.k.debug("loading tags");let t=c.x.PAGINATION_SIZE,e=1,s=[];try{do(s=await this.wp.tags().perPage(t).page(e)).forEach(t=>{this.tagIdMap.set(t.slug,t)}),e++;while(s.length>=t)}catch(t){throw d.k.error(t,"Error loading tags"),t}this.tagsLoaded=!0,d.k.debug("tags loaded")}getCategoryId(t){this.categoriesLoaded||this.loadCategories().then(()=>{});let e=this.categoryIdMap.get(t);if(!e)try{this.wp.categories().slug(t).then(t=>{this.categoryIdMap.set(t[0].slug,t[0])})}catch(s){let e="Error fetching category: ".concat(t);throw d.k.error(e),Error(e)}if(e=this.categoryIdMap.get(t))return e.id}getTagId(t){this.tagsLoaded||this.loadTags().then(()=>{this.tagIdMap});let e=this.tagIdMap.get(t);if(!e)try{this.wp.tags().slug(t).then(t=>{this.tagIdMap.set(t[0].slug,t[0])})}catch(s){let e="Error fetching tag: ".concat(t);throw d.k.error(e),Error(e)}if(e=this.tagIdMap.get(t))return e.id}getTaxonomyIds(t,e){let s=this.getCategoryId(t),r=this.getTagId(e);if(void 0===s||void 0===r)throw d.k.error({categorySlug:t,catId:s,tagSlug:e,tagId:r},"undefined category or tag"),Error("undefined category or tag");return[s,r]}async getPosts(t){let{categorySlug:e,tagIds:s,maxPosts:r=c.x.VISIBLE_ITEMS_PER_PAGE,sticky:a}=t,i=this.getCategoryId(e);if(void 0===i)throw Error("undefined category slug");if(0===s.length||(a&&(r=-1),0===r))return[];let n=c.x.PAGINATION_SIZE,o=s.map(t=>this.fetchMaxPostsByFn(this.createFetchFn({catId:i,tagId:t,sticky:a}),{maxPosts:r,pageSize:n})),d=await Promise.all(o),l=this.combinePosts(d);return r>0?l.slice(0,r):l}createFetchFn(t){let{catId:e,tagId:s,sticky:r}=t;return t=>{d.k.debug("createFetchFn params: ".concat(JSON.stringify({catId:e,tagId:s,sticky:r})));let a=this.wp.posts();return a=(a=(a=(a=(a=(a=a.perPage(t.pageSize).offset(t.offset)).orderby("date").order("desc")).after(c.x.djsAnniversarySince.toISOString())).status("publish")).categories(e)).tags(s),void 0!==r&&(a=a.sticky(r)),a.get()}}async fetchMaxPostsByFn(t,e){let{maxPosts:s,pageSize:r}=e,a=0,i=await t({offset:a,pageSize:r}),n=this.mapWpPosts(i),o=[...n];for(;(void 0===s||s>o.length)&&n.length>=r;)a+=r,i=await t({offset:a,pageSize:r}),o=[...o,...n=this.mapWpPosts(i)];return o}combinePosts(t){let e=t.flat(),s=new Map;e.forEach(t=>s.set(t.postId,t));let r=Array.from(s.values());return r.sort((t,e)=>t.date.isAfter(e.date)?-1:t.date.isBefore(e.date)?1:0),r}async fetchPostById(t){let{postId:e}=t,s=await this.wp.posts().id(e).status("publish").get();return d.k.info({postJson:s},"postJson"),p(s)}async fetchPostBySlug(t){let{slug:e}=t,s=await this.wp.posts().slug(e).status("publish").get();d.k.info({postsJson:s},"postJson");let r=this.mapWpPosts(s);if(r.length>0)return r[0];throw Error('Post not found by slug: "'.concat(e,'"'))}mapWpPosts(t){return t.map(t=>p(t))}constructor(t){this.categoryIdMap=new Map,this.tagIdMap=new Map,this.categoriesLoaded=!1,this.tagsLoaded=!1,this.activeYearTagIds=[],this.allTimeYearTagId=0,this.configLoaded=!1,this.config=h,this.wp=t}}let f=u.create(new(n())({endpoint:"https://pta.ycps.edu.hk/wp-json"})),p=t=>({postId:t.id,date:(0,o.Z)(t.date),guid:t.guid.rendered,title:t.title.rendered,content:t.content.rendered,excerpt:t.excerpt.rendered,sticky:t.sticky});async function y(t){return t.postId?await f.fetchPostById({postId:t.postId}):await f.fetchPostBySlug(t)}async function I(t){if(d.k.info("fetchPosts props: ".concat(JSON.stringify(t))),t.filterSticky){let e=await f.getPosts({...t,sticky:!0});d.k.info("fetchPosts getPosts sticky:".concat(JSON.stringify(e.length)));let s=await f.getPosts({...t,sticky:!1});return d.k.info("fetchPosts getPosts non-sticky:".concat(JSON.stringify(s.length))),{stickyPosts:e,posts:s}}let e=await f.getPosts(t);return d.k.info("fetchPosts getPosts all:".concat(JSON.stringify(e.length))),{stickyPosts:[],posts:e}}(async()=>{await f.getAllTimeYearTagId()})();let x=(0,a.no)("categories",{all:null}),E=(0,a.no)("tags",{all:null}),P=(0,a.no)("posts",{single:t=>({queryKey:[t.postId?t.postId:t.slug,t],queryFn:e=>y(t)}),byCategory:t=>({queryKey:[t.categorySlug,t.tagIds,t.filterSticky,t],queryFn:e=>I(t)})}),T=(0,a.kR)(x,E,P);function S(t){var e,s;let a={...t,tagIds:null!==(e=t.tagIds)&&void 0!==e?e:f.getActiveYearTagIds(!0),maxPosts:null!==(s=t.maxPosts)&&void 0!==s?s:c.x.VISIBLE_ITEMS_PER_PAGE};return d.k.debug("p: ".concat(JSON.stringify(a))),(0,r.a)(T.posts.byCategory(a))}function m(t){return(0,r.a)(T.posts.single(t))}},5204:function(t,e,s){"use strict";s.d(e,{x:function(){return n}});var r,a,i,n,o=s(4116);(r=n||(n={})).VISIBLE_ITEMS_PER_PAGE=50,r.PAGINATION_SIZE=100,r.djsAnniversarySince=(0,o.Z)("2022-09-01"),(r.PAGE_SLUGS||(r.PAGE_SLUGS={})).CONFIG="config",(a=r.TAG_SLUGS||(r.TAG_SLUGS={})).PTA_ALL_TIME="pta-all-time",a.PTA_2022_TO_2024="pta-2022-2024",(i=r.CATEGORY_SLUGS||(r.CATEGORY_SLUGS={})).MEMBERS_NEWS="members-news",i.MEMBERS_NOTICES="members-notices",i.MEMBERS_NEWSLETTERS="members-newsletters",i.MEMBERS_WELFARE="members-welfare",i.PTA_WORDS="pta-words",i.PTA_EXCO="pta-exco",i.PTA_DOCS="pta-docs",i.PTA_CONTACT="pta-contact",i.HELPERS_RECRUIT="helpers-recruit",i.HELPERS_HANDBOOK="helpers-handbook",i.HELPERS_CODE="helpers-code",i.EVENTS_CALENDAR="events-calendar",i.EVENTS_ALBUMS="events-albums"},6255:function(t,e,s){"use strict";s.d(e,{CenteredBox:function(){return a}});var r=s(8693);let a=(0,s(6210).ZP)(r.Z)({display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100vh",maxHeight:"400px"})},1069:function(t,e,s){"use strict";s.d(e,{Header:function(){return n}});var r=s(7437),a=s(8693),i=s(6387);function n(){return(0,r.jsx)(a.Z,{sx:{display:"flex",justifyContent:"center"},children:(0,r.jsx)(i.Z,{align:"center",variant:"h4",children:"油蔴地天主教小學(海泓道)家長教師會"})})}},6476:function(t,e,s){"use strict";s.d(e,{Post:function(){return y}});var r=s(7437),a=s(2265),i=s(8516),n=s(8984),o=s(6387),c=s(9832),d=s(2700),l=s(268),g=s(555),h=s(6045),u=s(5669),f=s(6796),p=s(7648);function y(t){let{post:e,collapsible:s=!0,defaultCollapsed:y=!1,showDate:I=!1,showPermaLink:x=!1,showStickiness:E=!1}=t,[P,T]=(0,a.useState)(!!y),S=(0,a.useCallback)(()=>{s&&T(t=>!t)},[s]);return(0,r.jsxs)(i.Z,{component:"article",sx:{padding:1},elevation:4,children:[(0,r.jsxs)(n.Z,{onClick:S,children:[(0,r.jsxs)(n.Z,{direction:"row",bgcolor:"lightgrey",paddingLeft:s?0:1,children:[!!s&&(P?(0,r.jsx)(d.Z,{}):(0,r.jsx)(l.Z,{})),(0,r.jsx)(o.Z,{variant:"h6",children:e.title}),E&&e.sticky&&(0,r.jsx)(g.Z,{fontSize:"small"}),x&&(0,r.jsx)(p.default,{href:{pathname:"/post/",query:{postId:e.postId}},onClick:t=>{t.stopPropagation()},children:(0,r.jsx)(c.Z,{"aria-label":"open post",children:(0,r.jsx)(h.Z,{fontSize:"small"})})})]}),I&&(0,r.jsxs)(o.Z,{variant:"caption",children:[(0,r.jsx)(u.Z,{fontSize:"inherit"})," ",e.date.fromNow()]})]}),!P&&(0,r.jsx)(f.UG,{children:e.content})]})}},6687:function(t,e,s){"use strict";s.d(e,{Posts:function(){return f}});var r=s(7437);s(9978);var a=s(7009),i=s(6387),n=s(4013),o=s(3053),c=s(8984),d=s(7494),l=s(5204),g=s(6255),h=s(949),u=s(6476);function f(t){let{categorySlug:e,tagIds:s,showDate:f=!1,maxPosts:p=l.x.VISIBLE_ITEMS_PER_PAGE,collapseAfter:y=5,stickyFirst:I,showPermaLink:x=!1,showStickiness:E=!1}=t,{isPending:P,isError:T,data:S,error:m,refetch:w}=(0,h.k)({categorySlug:e,tagIds:s,filterSticky:!!I,maxPosts:p}),v=async()=>{w()};if(T)return a.k.error(m,"error fetching posts"),(0,r.jsx)("section",{children:(0,r.jsxs)(g.CenteredBox,{children:[(0,r.jsx)(i.Z,{variant:"h5",gutterBottom:!0,color:"error",children:"Error loading data"}),(0,r.jsx)(n.Z,{variant:"contained",onClick:v,children:"Reload"})]})});if(P)return(0,r.jsx)("section",{children:(0,r.jsx)(g.CenteredBox,{children:(0,r.jsx)(o.Z,{})})});let{stickyPosts:k,posts:_}=S;return 0===k.length&&0===_.length?(0,r.jsx)("section",{children:(0,r.jsx)(g.CenteredBox,{children:(0,r.jsx)(i.Z,{children:"Coming soon. Stay tuned."})})}):(0,r.jsxs)("section",{children:[(0,r.jsx)(c.Z,{divider:(0,r.jsx)(d.Z,{flexItem:!0}),children:k.map((t,e)=>(0,r.jsx)(u.Post,{showDate:f,post:t,defaultCollapsed:!1,showPermaLink:x,showStickiness:E},t.guid))}),(0,r.jsx)(c.Z,{divider:(0,r.jsx)(d.Z,{flexItem:!0}),children:_.map((t,e)=>(0,r.jsx)(u.Post,{showDate:f,post:t,defaultCollapsed:void 0!==y&&!(y<0)&&e>=y,showPermaLink:x,showStickiness:E},t.guid))})]})}},6796:function(t,e,s){"use strict";s.d(e,{UG:function(){return o},m$:function(){return l}}),s(6255);var r=s(7437);s(1069);var a=s(9976),i=s(1305),n=s(51);let o=t=>{let{children:e}=t;return(0,r.jsx)(a.U,{remarkPlugins:[i.Z],rehypePlugins:[n.Z],children:e})};s(6476),s(6687);var c=s(8693),d=s(6387);let l=t=>e=>{let{children:s}=e;return(0,r.jsxs)(c.Z,{children:[(0,r.jsx)("header",{children:(0,r.jsx)(d.Z,{variant:"h5",color:"secondary.contrastText",bgcolor:"secondary.main",paddingX:1,align:"center",children:t.title})}),(0,r.jsx)("section",{children:(0,r.jsx)(c.Z,{sx:{paddingX:0},children:s})})]})}},9978:function(){}}]);